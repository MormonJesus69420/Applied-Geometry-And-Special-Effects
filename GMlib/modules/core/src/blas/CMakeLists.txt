# ###############################################################################
# #
# # Copyright (C) 1994 Narvik University College
# # Contact: GMlib Online Portal at http://episteme.hin.no
# #
# # This file is part of the Geometric Modeling Library, GMlib.
# #
# # GMlib is free software: you can redistribute it and/or modify
# # it under the terms of the GNU Lesser General Public License as published by
# # the Free Software Foundation, either version 3 of the License, or
# # (at your option) any later version.
# #
# # GMlib is distributed in the hope that it will be useful,
# # but WITHOUT ANY WARRANTY; without even the implied warranty of
# # MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
# # GNU Lesser General Public License for more details.
# #
# # You should have received a copy of the GNU Lesser General Public License
# # along with GMlib. If not, see <http://www.gnu.org/licenses/>.
# #
# ###############################################################################



set(BLAS_HEADER_DIR "${BUILD_INCLUDE_DIR}/core/blas")
set(BLAS_HEADER_FILE_PREFIX "${BLAS_HEADER_DIR}/gmblas")
set(BLAS_HEADER_FILE_SUFFIX "includes.h")

# Cleanup
file(GLOB OLD_BLAS_HEADERS "${BLAS_HEADER_FILE_PREFIX}*")
if(OLD_BLAS_HEADERS)
  file(REMOVE ${OLD_BLAS_HEADERS})
endif(OLD_BLAS_HEADERS)

# Generate empty headers
file(WRITE "${BLAS_HEADER_FILE_PREFIX}dmatrix${BLAS_HEADER_FILE_SUFFIX}" "// This file was generated by CMake.\n")

# For adding a line verbatim to the generated header
macro(addBlasHeaderLines CLASSNAME)
  string(TOLOWER ${CLASSNAME} CLASSNAME_LOWER)
  foreach(SOURCE ${ARGN})
    file(APPEND "${BLAS_HEADER_FILE_PREFIX}${CLASSNAME_LOWER}${BLAS_HEADER_FILE_SUFFIX}" "\n${SOURCE}")
  endforeach(SOURCE ${ARGN})
endmacro(addBlasHeaderLines CLASSNAME)

# For including a file in the generated header
macro(addBlasHeaders CLASSNAME)
  string(TOLOWER ${CLASSNAME} CLASSNAME_LOWER)
  foreach(SOURCE ${ARGN})
    file(RELATIVE_PATH REL_PATH "${BLAS_HEADER_DIR}" "${CMAKE_CURRENT_LIST_DIR}/${SOURCE}")
  file(APPEND ${BLAS_HEADER_FILE_PREFIX}${CLASSNAME_LOWER}${BLAS_HEADER_FILE_SUFFIX} "\n#include \"${REL_PATH}\"")
  endforeach(SOURCE ${ARGN})
endmacro(addBlasHeaders)

if(GMLIB_BLAS STREQUAL "OpenBLAS")
  addSubDirectory(cblas)
elseif(GMLIB_BLAS STREQUAL "MKL")
  addSubDirectory(cblas)
  addSubDirectory(mkl)
elseif(GMLIB_BLAS STREQUAL "ACML")
  addSubDirectory(acml)
elseif(GMLIB_BLAS STREQUAL "APPML")
  addSubDirectory(appml)
elseif(GMLIB_BLAS STREQUAL "CuBLAS")
  addSubDirectory(cublas)
elseif(GMLIB_BLAS STREQUAL "ViennaCL")
  addSubDirectory(viennacl)
elseif(GMLIB_BLAS STREQUAL "CBLAS")
  addSubDirectory(cblas)
endif(GMLIB_BLAS STREQUAL "OpenBLAS")
